<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logo ‚Üí Code</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--surface:#12121a;--surface2:#1a1a25;--surface3:#22222f;--border:#2a2a3a;--text:#e4e4e7;--text2:#a1a1aa;--accent:#00e87b;--accent2:#00c966;--red:#ff4466;--blue:#3b82f6}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;display:flex;flex-direction:column}
input,select,textarea,button{font-family:inherit;color:var(--text);outline:none}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* Header */
header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0}
header h1{font-size:18px;font-weight:600;display:flex;align-items:center;gap:8px}
header h1 span{color:var(--accent)}
.header-actions{display:flex;gap:8px;align-items:center}
.api-btn{padding:6px 14px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);cursor:pointer;font-size:12px;transition:.2s}
.api-btn:hover{border-color:var(--accent)}
.api-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px}
.api-dot.on{background:var(--accent)}.api-dot.off{background:var(--red)}

/* Layout */
.layout{display:flex;flex:1;overflow:hidden}
.left-panel{width:380px;min-width:380px;border-right:1px solid var(--border);overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:20px}
.right-panel{flex:1;overflow-y:auto;padding:20px;background:var(--bg)}

/* Section */
.section{display:flex;flex-direction:column;gap:10px}
.section-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text2)}

/* Drop Zone */
.dropzone{border:2px dashed var(--border);border-radius:12px;padding:30px 20px;text-align:center;cursor:pointer;transition:.3s;position:relative}
.dropzone:hover,.dropzone.over{border-color:var(--accent);background:rgba(0,232,123,.03)}
.dropzone-label{font-size:13px;color:var(--text2)}
.dropzone-label strong{color:var(--accent)}
.thumbs{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.thumb{width:64px;height:64px;border-radius:8px;overflow:hidden;position:relative;border:1px solid var(--border);background:var(--surface2)}
.thumb img{width:100%;height:100%;object-fit:contain}
.thumb .remove{position:absolute;top:-4px;right:-4px;width:18px;height:18px;border-radius:50%;background:var(--red);color:#fff;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px solid var(--bg)}
.thumb-count{font-size:11px;color:var(--text2);text-align:right}

/* Inputs */
label.field{display:flex;flex-direction:column;gap:4px}
label.field span{font-size:12px;color:var(--text2);font-weight:500}
input[type="text"],select,textarea{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-size:13px;transition:.2s;width:100%}
input[type="text"]:focus,select:focus,textarea:focus{border-color:var(--accent)}
textarea{resize:vertical;min-height:70px;font-family:'Inter',sans-serif}
select{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23a1a1aa' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}

/* Chips */
.chips{display:flex;flex-wrap:wrap;gap:6px}
.chip{padding:6px 12px;border-radius:20px;border:1px solid var(--border);background:var(--surface2);font-size:12px;cursor:pointer;transition:.2s;user-select:none}
.chip:hover{border-color:var(--text2)}.chip.active{border-color:var(--accent);background:rgba(0,232,123,.1);color:var(--accent)}

/* Color Pickers */
.color-row{display:flex;gap:10px;align-items:center}
.color-pick{display:flex;flex-direction:column;align-items:center;gap:4px}
.color-pick label{font-size:10px;color:var(--text2)}
.color-pick input[type="color"]{width:40px;height:32px;border:1px solid var(--border);border-radius:6px;background:var(--surface2);cursor:pointer;padding:2px}
.auto-toggle{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text2);cursor:pointer;margin-top:4px}
.auto-toggle input{accent-color:var(--accent)}

/* Slider */
.slider-row{display:flex;align-items:center;gap:12px}
.slider-row input[type="range"]{flex:1;accent-color:var(--accent)}
.slider-val{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:500;color:var(--accent);min-width:20px;text-align:center}

/* Generate Button */
.generate-btn{padding:14px;border-radius:10px;border:none;background:var(--accent);color:#0a0a0f;font-size:14px;font-weight:600;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;gap:8px}
.generate-btn:hover{background:var(--accent2)}.generate-btn:disabled{opacity:.5;cursor:not-allowed}
.generate-btn .spinner{width:16px;height:16px;border:2px solid rgba(0,0,0,.2);border-top-color:#0a0a0f;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Preview Grid */
.preview-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text2);gap:12px}
.preview-empty svg{opacity:.3}
.preview-empty p{font-size:14px}
.preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));gap:20px}
.logo-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:.2s}
.logo-card:hover{border-color:var(--accent)}
.card-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
.card-title{font-size:14px;font-weight:600}
.card-concept{font-size:11px;color:var(--text2);margin-top:2px}
.card-controls{display:flex;gap:6px}
.card-btn{padding:4px 8px;border-radius:5px;border:1px solid var(--border);background:var(--surface2);cursor:pointer;font-size:10px;color:var(--text2);transition:.2s;display:flex;align-items:center;gap:4px}
.card-btn:hover{border-color:var(--accent);color:var(--accent)}
.card-btn.bg-toggle{position:relative}
.card-btn.bg-toggle .dot{width:6px;height:6px;border-radius:50%}

/* Size Previews */
.size-previews{display:flex;align-items:flex-end;justify-content:center;gap:24px;padding:30px 20px;min-height:200px;transition:background .3s}
.size-previews.dark-bg{background:var(--bg)}.size-previews.light-bg{background:#f0f0f0}
.size-preview{display:flex;flex-direction:column;align-items:center;gap:6px}
.size-preview .label{font-size:9px;color:var(--text2);font-family:'JetBrains Mono',monospace}
.size-previews.light-bg .label{color:#666}
.size-preview .svg-wrap{display:flex;align-items:center;justify-content:center}
.size-preview .svg-wrap svg{width:100%;height:100%}

/* Export Row */
.export-row{display:flex;gap:6px;padding:12px 16px;border-top:1px solid var(--border);flex-wrap:wrap}
.export-btn{padding:6px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);cursor:pointer;font-size:11px;color:var(--text2);transition:.2s;display:flex;align-items:center;gap:4px}
.export-btn:hover{border-color:var(--accent);color:var(--accent)}
.export-btn.copied{border-color:var(--accent);color:var(--accent)}

/* Refine */
.refine-row{display:flex;gap:8px;padding:0 16px 14px}
.refine-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-size:12px}
.refine-row input:focus{border-color:var(--accent)}
.refine-row button{padding:8px 14px;border-radius:8px;border:1px solid var(--accent);background:transparent;color:var(--accent);font-size:12px;cursor:pointer;white-space:nowrap;transition:.2s}
.refine-row button:hover{background:rgba(0,232,123,.1)}

/* Toast */
.toast{position:fixed;bottom:20px;right:20px;padding:10px 18px;background:var(--surface);border:1px solid var(--accent);border-radius:8px;font-size:13px;color:var(--accent);z-index:999;animation:fadeIn .2s}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* Modal */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;display:flex;align-items:center;justify-content:center}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;width:400px;display:flex;flex-direction:column;gap:16px}
.modal h3{font-size:16px}.modal input{width:100%}
.modal-actions{display:flex;gap:8px;justify-content:flex-end}
.modal-actions button{padding:8px 18px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-weight:500}
.modal-actions .save{background:var(--accent);color:#0a0a0f}.modal-actions .cancel{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}

/* Loading overlay */
.loading-overlay{position:absolute;inset:0;background:rgba(10,10,15,.85);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;z-index:10;border-radius:14px}
.loading-overlay .spinner-lg{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
.loading-overlay p{font-size:13px;color:var(--text2)}

@media(max-width:900px){.layout{flex-direction:column}.left-panel{width:100%;min-width:0;max-height:50vh;border-right:none;border-bottom:1px solid var(--border)}.preview-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <h1>üé® Logo <span>‚Üí</span> Code</h1>
  <div class="header-actions">
    <button class="api-btn" id="apiBtn"><span class="api-dot off" id="apiDot"></span>API Key</button>
  </div>
</header>

<div class="layout">
  <div class="left-panel">
    <!-- Inspiration -->
    <div class="section">
      <div class="section-title">Inspiration Logos</div>
      <div class="dropzone" id="dropzone">
        <div class="dropzone-label">Drop logo images here or <strong>click to browse</strong><br><span style="font-size:11px;color:var(--text2)">PNG, JPG, SVG ‚Ä¢ Up to 8 images</span></div>
        <input type="file" id="fileInput" multiple accept="image/*,.svg" style="display:none">
        <div class="thumbs" id="thumbs"></div>
      </div>
      <div class="thumb-count" id="thumbCount"></div>
    </div>

    <!-- Brand Context -->
    <div class="section">
      <div class="section-title">Brand Context</div>
      <label class="field"><span>Brand Name</span><input type="text" id="brandName" placeholder="e.g. Nebula Labs"></label>
      <label class="field"><span>Industry</span>
        <select id="industry">
          <option value="">Select industry...</option>
          <option>Tech</option><option>Food</option><option>Fashion</option><option>Music</option><option>Sports</option><option>Finance</option><option>Health</option><option>Education</option><option>Creative</option><option>Other</option>
        </select>
      </label>
    </div>

    <!-- Vibe -->
    <div class="section">
      <div class="section-title">Style / Vibe</div>
      <div class="chips" id="vibeChips"></div>
    </div>

    <!-- Colors -->
    <div class="section">
      <div class="section-title">Colors</div>
      <label class="auto-toggle"><input type="checkbox" id="autoColor" checked> Auto from inspiration</label>
      <div class="color-row" id="colorRow" style="display:none">
        <div class="color-pick"><input type="color" id="colorPrimary" value="#00e87b"><label>Primary</label></div>
        <div class="color-pick"><input type="color" id="colorSecondary" value="#3b82f6"><label>Secondary</label></div>
        <div class="color-pick"><input type="color" id="colorAccent" value="#ffffff"><label>Accent</label></div>
      </div>
    </div>

    <!-- Prompt -->
    <div class="section">
      <div class="section-title">Additional Direction</div>
      <textarea id="prompt" placeholder="e.g. Modern tech feel, think Stripe meets Figma. Prefer a logomark that works as an app icon..."></textarea>
    </div>

    <!-- Variations -->
    <div class="section">
      <div class="section-title">Variations</div>
      <div class="slider-row">
        <input type="range" id="variations" min="3" max="6" value="4" step="1">
        <span class="slider-val" id="varVal">4</span>
      </div>
    </div>

    <!-- Generate -->
    <button class="generate-btn" id="generateBtn" onclick="generate()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      Generate Logos
    </button>
  </div>

  <div class="right-panel" id="rightPanel">
    <div class="preview-empty" id="emptyState">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      <p>Configure your brand and hit Generate</p>
    </div>
    <div class="preview-grid" id="previewGrid" style="display:none"></div>
  </div>
</div>

<!-- API Key Modal -->
<div class="modal-bg" id="apiModal" style="display:none">
  <div class="modal">
    <h3>Anthropic API Key</h3>
    <label class="field"><span>API Key</span><input type="text" id="apiKeyInput" placeholder="sk-ant-..."></label>
    <div class="modal-actions">
      <button class="cancel" onclick="closeApiModal()">Cancel</button>
      <button class="save" onclick="saveApiKey()">Save</button>
    </div>
  </div>
</div>

<script>
// State
const state = {
  images: [], // {dataUrl, file}
  vibes: [],
  logos: [], // {name, concept, svg}
};
const VIBES = ['Minimal','Bold','Playful','Elegant','Geometric','Organic','Retro','Futuristic','Hand-drawn','Corporate'];

// Init
(function init() {
  // Vibe chips
  const container = document.getElementById('vibeChips');
  VIBES.forEach(v => {
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = v;
    chip.onclick = () => {
      chip.classList.toggle('active');
      if (chip.classList.contains('active')) state.vibes.push(v);
      else state.vibes = state.vibes.filter(x => x !== v);
    };
    container.appendChild(chip);
  });

  // Auto color toggle
  document.getElementById('autoColor').onchange = e => {
    document.getElementById('colorRow').style.display = e.target.checked ? 'none' : 'flex';
  };

  // Variation slider
  document.getElementById('variations').oninput = e => {
    document.getElementById('varVal').textContent = e.target.value;
  };

  // API key status
  updateApiStatus();

  // Dropzone
  const dz = document.getElementById('dropzone');
  const fi = document.getElementById('fileInput');
  dz.onclick = (e) => { if (e.target.closest('.remove')) return; fi.click(); };
  dz.ondragover = e => { e.preventDefault(); dz.classList.add('over'); };
  dz.ondragleave = () => dz.classList.remove('over');
  dz.ondrop = e => { e.preventDefault(); dz.classList.remove('over'); handleFiles(e.dataTransfer.files); };
  fi.onchange = e => handleFiles(e.target.files);
})();

function handleFiles(files) {
  for (const f of files) {
    if (state.images.length >= 8) break;
    if (!f.type.startsWith('image/') && !f.name.endsWith('.svg')) continue;
    const reader = new FileReader();
    reader.onload = e => {
      state.images.push({ dataUrl: e.target.result, name: f.name });
      renderThumbs();
    };
    reader.readAsDataURL(f);
  }
}

function renderThumbs() {
  const c = document.getElementById('thumbs');
  c.innerHTML = '';
  state.images.forEach((img, i) => {
    const d = document.createElement('div');
    d.className = 'thumb';
    d.innerHTML = `<img src="${img.dataUrl}"><div class="remove" onclick="event.stopPropagation();removeImage(${i})">√ó</div>`;
    c.appendChild(d);
  });
  document.getElementById('thumbCount').textContent = state.images.length ? `${state.images.length}/8 images` : '';
}

function removeImage(i) {
  state.images.splice(i, 1);
  renderThumbs();
}

// API Key
function updateApiStatus() {
  const key = localStorage.getItem('anthropic_api_key');
  const dot = document.getElementById('apiDot');
  dot.className = 'api-dot ' + (key ? 'on' : 'off');
}
document.getElementById('apiBtn').onclick = () => {
  document.getElementById('apiKeyInput').value = localStorage.getItem('anthropic_api_key') || '';
  document.getElementById('apiModal').style.display = 'flex';
};
function closeApiModal() { document.getElementById('apiModal').style.display = 'none'; }
function saveApiKey() {
  const k = document.getElementById('apiKeyInput').value.trim();
  if (k) localStorage.setItem('anthropic_api_key', k);
  else localStorage.removeItem('anthropic_api_key');
  updateApiStatus();
  closeApiModal();
}

// Toast
function toast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2500);
}

// Build system prompt
function buildSystemPrompt() {
  return `You are an expert logo designer and SVG craftsman. Generate original, professional logo designs as clean SVG code.

SVG REQUIREMENTS:
- Use viewBox="0 0 200 200" (square, scalable)
- NO fixed width/height attributes on the root <svg>
- Clean, optimized paths with proper grouping (<g> elements)
- All elements must be self-contained (no external references)
- Use proper SVG structure: defs for reusables, logical grouping

LOGO DESIGN PRINCIPLES:
- Each variation must be a FUNDAMENTALLY DIFFERENT concept (wordmark, icon+text, monogram, abstract mark, lettermark, emblem, mascot, geometric, etc.)
- NOT just color swaps or minor tweaks ‚Äî each should explore a unique direction
- Must work at ALL sizes: 32px favicon to 400px+ display
- Must work in monochrome (strong silhouette)
- Clear negative space, memorable shape
- Maximum 2-3 colors per logo (plus optional neutral/white/black)
- Strong contrast and readability

TYPOGRAPHY IN SVG:
- For text elements, use web-safe fonts: Arial, Helvetica, Georgia, or system fonts
- Use <text> elements with appropriate font-family, font-weight, font-size
- Letter-spacing and positioning should be precise
- For custom letterforms, convert to <path> elements

COLOR THEORY:
- Limit palette to 2-3 intentional colors
- Ensure sufficient contrast (WCAG-aware)
- Colors should reinforce brand personality

OUTPUT FORMAT:
Return ONLY valid JSON (no markdown, no code fences). Format:
[
  {
    "name": "Variation Name",
    "concept": "Brief description of the design approach",
    "svg": "<svg viewBox=\\"0 0 200 200\\" xmlns=\\"http://www.w3.org/2000/svg\\">...</svg>"
  }
]

CRITICAL: Output raw JSON only. No \`\`\` blocks. No explanation outside the JSON array.`;
}

// Build user prompt
function buildUserPrompt(count, refineText, refineIndex) {
  const brand = document.getElementById('brandName').value.trim();
  const industry = document.getElementById('industry').value;
  const autoColor = document.getElementById('autoColor').checked;
  const prompt = document.getElementById('prompt').value.trim();

  let msg = '';
  if (refineText && refineIndex !== undefined) {
    const logo = state.logos[refineIndex];
    msg = `I have an existing logo design called "${logo.name}" (concept: ${logo.concept}). Here is its SVG:\n${logo.svg}\n\nPlease modify it based on this feedback: ${refineText}\n\nReturn exactly 1 variation in the same JSON array format.`;
    return msg;
  }

  msg = `Design ${count} unique logo variations`;
  if (brand) msg += ` for the brand "${brand}"`;
  if (industry) msg += ` in the ${industry} industry`;
  msg += '.\n\n';

  if (state.vibes.length) msg += `Style/vibe: ${state.vibes.join(', ')}\n`;
  if (!autoColor) {
    msg += `Colors: Primary ${document.getElementById('colorPrimary').value}, Secondary ${document.getElementById('colorSecondary').value}, Accent ${document.getElementById('colorAccent').value}\n`;
  } else if (state.images.length) {
    msg += `Analyze the inspiration images for color palette, shapes, negative space, weight, and style.\n`;
  }
  if (prompt) msg += `\nAdditional direction: ${prompt}\n`;
  if (state.images.length) msg += `\nI'm providing ${state.images.length} inspiration logo image(s). Analyze them for: shapes, negative space, visual weight, style patterns, color relationships. Draw inspiration but create ORIGINAL designs.\n`;

  msg += `\nGenerate exactly ${count} variations. Each must be a different concept type (e.g., wordmark, icon+text, monogram, abstract, lettermark, emblem).`;
  return msg;
}

// Call Claude API
async function callClaude(userPrompt, includeImages = true) {
  const key = localStorage.getItem('anthropic_api_key');
  if (!key) { toast('Set your API key first'); return null; }

  const content = [];
  if (includeImages && state.images.length) {
    for (const img of state.images) {
      const match = img.dataUrl.match(/^data:(.*?);base64,(.*)$/);
      if (match) {
        let mediaType = match[1];
        if (mediaType === 'image/svg+xml') mediaType = 'image/png'; // Claude doesn't accept SVG as image
        content.push({ type: 'image', source: { type: 'base64', media_type: mediaType, data: match[2] } });
      }
    }
  }
  content.push({ type: 'text', text: userPrompt });

  const resp = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': key,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-opus-4-0-20250514',
      max_tokens: 16000,
      system: buildSystemPrompt(),
      messages: [{ role: 'user', content }]
    })
  });

  if (!resp.ok) {
    const err = await resp.text();
    throw new Error(`API error ${resp.status}: ${err}`);
  }
  const data = await resp.json();
  const text = data.content.map(c => c.text || '').join('');
  
  // Parse JSON from response (handle potential markdown fences)
  let jsonStr = text.trim();
  if (jsonStr.startsWith('```')) {
    jsonStr = jsonStr.replace(/^```(?:json)?\n?/, '').replace(/\n?```$/, '');
  }
  return JSON.parse(jsonStr);
}

// Generate
async function generate() {
  const btn = document.getElementById('generateBtn');
  const count = parseInt(document.getElementById('variations').value);
  
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> Generating...';
  
  try {
    const prompt = buildUserPrompt(count);
    const logos = await callClaude(prompt);
    if (!logos) return;
    state.logos = logos;
    renderLogos();
    toast(`Generated ${logos.length} logo variations`);
  } catch (e) {
    console.error(e);
    toast('Error: ' + e.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg> Generate Logos';
  }
}

// Render logos
function renderLogos() {
  const grid = document.getElementById('previewGrid');
  const empty = document.getElementById('emptyState');
  
  if (!state.logos.length) {
    grid.style.display = 'none';
    empty.style.display = 'flex';
    return;
  }
  
  empty.style.display = 'none';
  grid.style.display = 'grid';
  grid.innerHTML = '';
  
  state.logos.forEach((logo, i) => {
    const card = document.createElement('div');
    card.className = 'logo-card';
    card.id = `card-${i}`;
    
    const sizes = [
      { label: '32px', size: 32 },
      { label: '64px', size: 64 },
      { label: '200px', size: 200 },
      { label: '400px', size: 400 }
    ];
    
    const sizePreviews = sizes.map(s => `
      <div class="size-preview">
        <div class="svg-wrap" style="width:${s.size}px;height:${s.size}px">${logo.svg}</div>
        <span class="label">${s.label}</span>
      </div>
    `).join('');
    
    card.innerHTML = `
      <div class="card-header">
        <div>
          <div class="card-title">#${i+1} ‚Äî ${esc(logo.name)}</div>
          <div class="card-concept">${esc(logo.concept)}</div>
        </div>
        <div class="card-controls">
          <button class="card-btn bg-toggle" onclick="toggleBg(${i})" title="Toggle background">
            <div class="dot" style="background:#fff"></div>/<div class="dot" style="background:#000"></div>
          </button>
          <button class="card-btn" onclick="regenerateSingle(${i})" title="Regenerate">‚Üª</button>
        </div>
      </div>
      <div class="size-previews dark-bg" id="previews-${i}">${sizePreviews}</div>
      <div class="export-row">
        <button class="export-btn" onclick="copySvg(${i})">üìã SVG</button>
        <button class="export-btn" onclick="downloadSvg(${i})">üíæ .svg</button>
        <button class="export-btn" onclick="copyJsx(${i})">‚öõÔ∏è JSX</button>
        <button class="export-btn" onclick="downloadPng(${i})">üñº PNG</button>
      </div>
      <div class="refine-row">
        <input type="text" placeholder="Refine: e.g. make more minimal, try in blue..." id="refine-${i}">
        <button onclick="refineSingle(${i})">Refine</button>
      </div>
    `;
    grid.appendChild(card);
  });
}

function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

// Toggle background
function toggleBg(i) {
  const el = document.getElementById(`previews-${i}`);
  el.classList.toggle('dark-bg');
  el.classList.toggle('light-bg');
}

// Regenerate single
async function regenerateSingle(i) {
  const card = document.getElementById(`card-${i}`);
  const overlay = document.createElement('div');
  overlay.className = 'loading-overlay';
  overlay.innerHTML = '<div class="spinner-lg"></div><p>Regenerating...</p>';
  card.style.position = 'relative';
  card.appendChild(overlay);
  
  try {
    const count = 1;
    const brand = document.getElementById('brandName').value.trim();
    const industry = document.getElementById('industry').value;
    let prompt = `Generate 1 new logo variation`;
    if (brand) prompt += ` for "${brand}"`;
    if (industry) prompt += ` (${industry})`;
    prompt += `. It should be different from these existing concepts: ${state.logos.map(l => l.concept).join('; ')}`;
    if (state.vibes.length) prompt += `. Style: ${state.vibes.join(', ')}`;
    prompt += '. Return exactly 1 variation.';
    
    const logos = await callClaude(prompt);
    if (logos && logos.length) {
      state.logos[i] = logos[0];
      renderLogos();
      toast('Regenerated variation #' + (i + 1));
    }
  } catch (e) {
    toast('Error: ' + e.message);
  } finally {
    overlay.remove();
  }
}

// Refine single
async function refineSingle(i) {
  const input = document.getElementById(`refine-${i}`);
  const text = input.value.trim();
  if (!text) return;
  
  const card = document.getElementById(`card-${i}`);
  const overlay = document.createElement('div');
  overlay.className = 'loading-overlay';
  overlay.innerHTML = '<div class="spinner-lg"></div><p>Refining...</p>';
  card.style.position = 'relative';
  card.appendChild(overlay);
  
  try {
    const prompt = buildUserPrompt(1, text, i);
    const logos = await callClaude(prompt, false);
    if (logos && logos.length) {
      state.logos[i] = logos[0];
      renderLogos();
      toast('Refined variation #' + (i + 1));
    }
  } catch (e) {
    toast('Error: ' + e.message);
  } finally {
    overlay.remove();
  }
}

// Export functions
function copySvg(i) {
  navigator.clipboard.writeText(state.logos[i].svg);
  toast('SVG copied to clipboard');
}

function downloadSvg(i) {
  const blob = new Blob([state.logos[i].svg], { type: 'image/svg+xml' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${state.logos[i].name.replace(/\s+/g, '-').toLowerCase()}.svg`;
  a.click();
  URL.revokeObjectURL(a.href);
}

function copyJsx(i) {
  const svg = state.logos[i].svg;
  let jsx = svg
    .replace(/class="/g, 'className="')
    .replace(/clip-path="/g, 'clipPath="')
    .replace(/fill-rule="/g, 'fillRule="')
    .replace(/clip-rule="/g, 'clipRule="')
    .replace(/stroke-width="/g, 'strokeWidth="')
    .replace(/stroke-linecap="/g, 'strokeLinecap="')
    .replace(/stroke-linejoin="/g, 'strokeLinejoin="')
    .replace(/stroke-dasharray="/g, 'strokeDasharray="')
    .replace(/stroke-dashoffset="/g, 'strokeDashoffset="')
    .replace(/font-family="/g, 'fontFamily="')
    .replace(/font-size="/g, 'fontSize="')
    .replace(/font-weight="/g, 'fontWeight="')
    .replace(/text-anchor="/g, 'textAnchor="')
    .replace(/dominant-baseline="/g, 'dominantBaseline="')
    .replace(/letter-spacing="/g, 'letterSpacing="');
  
  const name = state.logos[i].name.replace(/[^a-zA-Z0-9]/g, '');
  const component = `const ${name || 'Logo'} = (props) => (\n  ${jsx.replace('<svg ', '<svg {...props} ')}\n);\n\nexport default ${name || 'Logo'};`;
  navigator.clipboard.writeText(component);
  toast('React component copied');
}

function downloadPng(i) {
  const svg = state.logos[i].svg;
  const canvas = document.createElement('canvas');
  canvas.width = 1024;
  canvas.height = 1024;
  const ctx = canvas.getContext('2d');
  const img = new Image();
  const blob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  img.onload = () => {
    ctx.drawImage(img, 0, 0, 1024, 1024);
    URL.revokeObjectURL(url);
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = `${state.logos[i].name.replace(/\s+/g, '-').toLowerCase()}.png`;
    a.click();
  };
  img.src = url;
}
</script>
</body>
</html>
